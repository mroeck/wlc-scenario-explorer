services:
  frontend-prod:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: prod
    ports:
      - "3001:3001"
    depends_on:
      - backend-prod
    profiles: ["prod"]

  backend-prod:
    build:
      context: ./backend
      dockerfile: Dockerfile
      target: prod
    ports:
      - "8081:8081"
    profiles: ["prod"]

  playwright:
    image: mcr.microsoft.com/playwright:v1.44.1-jammy
    depends_on:
      - frontend-prod
    volumes:
      - ./tests:/tests
    working_dir: /tests
    entrypoint: ["/bin/sh", "-c", "while ! curl -s http://frontend-prod:3001/health; do sleep 5; done && pnpm exec playwright test"]
